<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Ares: BulletExt::BulletExt::ExtData Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="class_bullet_ext.html">BulletExt</a>::<a class="el" href="class_bullet_ext_1_1_ext_data.html">ExtData</a>
  </div>
</div>
<div class="contents">
<h1>BulletExt::BulletExt::ExtData Class Reference</h1><!-- doxytag: class="BulletExt::ExtData" --><!-- doxytag: inherits="Extension&lt; TT &gt;" --><code>#include &lt;Ext/Bullet/Body.h&gt;</code>
<p>
<div class="dynheader">
Inheritance diagram for BulletExt::BulletExt::ExtData:</div>
<div class="dynsection">

<p><center><img src="class_bullet_ext_1_1_ext_data.png" usemap="#BulletExt::BulletExt::ExtData_map" border="0" alt=""></center>
<map name="BulletExt::BulletExt::ExtData_map">
<area href="class_extension.html" alt="Extension< TT >" shape="rect" coords="0,0,163,24">
</map>
</div>

<p>
<a href="class_bullet_ext_1_1_ext_data-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bullet_ext_1_1_ext_data.html#a69d8ba88dcd66f5bda4a8a7be1e5843">ExtData</a> (const DWORD <a class="el" href="class_extension.html#2f0c543d5bceafd46d103be4f87a5abe">Canary</a>, <a class="el" href="class_bullet_ext.html#0af4200a0e57e1989fd519e42863006c">TT</a> *const OwnerObject)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bullet_ext_1_1_ext_data.html#819ce3b613e68f041639f552c350a530">~ExtData</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bullet_ext_1_1_ext_data.html#12b7a9fd2c818556e3dc259463ee759e">Size</a> () const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bullet_ext_1_1_ext_data.html#a3afac5846ade163b708d9d5b9007e53">DamageOccupants</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Does the entire PassThrough logic, checks &amp; damage.  <a href="#a3afac5846ade163b708d9d5b9007e53"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_bullet_ext_1_1_ext_data.html#990f09b1655f70efb5b746852f676442">InvalidatePointer</a> (void *ptr)</td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a69d8ba88dcd66f5bda4a8a7be1e5843"></a><!-- doxytag: member="BulletExt::ExtData::ExtData" ref="a69d8ba88dcd66f5bda4a8a7be1e5843" args="(const DWORD Canary, TT *const OwnerObject)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BulletExt::BulletExt::ExtData::ExtData           </td>
          <td>(</td>
          <td class="paramtype">const DWORD&nbsp;</td>
          <td class="paramname"> <em>Canary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_bullet_ext.html#0af4200a0e57e1989fd519e42863006c">TT</a> *const &nbsp;</td>
          <td class="paramname"> <em>OwnerObject</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00024"></a>00024                                                                    : <a class="code" href="class_extension.html#3f8a8fd621ae648a99ab593e8d69681e">Extension</a>(<a class="code" href="class_extension.html#2f0c543d5bceafd46d103be4f87a5abe">Canary</a>, OwnerObject)
<a name="l00025"></a>00025                         { };
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="819ce3b613e68f041639f552c350a530"></a><!-- doxytag: member="BulletExt::ExtData::~ExtData" ref="819ce3b613e68f041639f552c350a530" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual BulletExt::BulletExt::ExtData::~ExtData           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00027"></a>00027                                    {
<a name="l00028"></a>00028                 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="a3afac5846ade163b708d9d5b9007e53"></a><!-- doxytag: member="BulletExt::ExtData::DamageOccupants" ref="a3afac5846ade163b708d9d5b9007e53" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool BulletExt::BulletExt::ExtData::DamageOccupants           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Does the entire PassThrough logic, checks &amp; damage. 
<p>
This function determines whether the projectile should pass through the outter shell of a building and damage the occupants instead.<p>
If so, it proceeds to damage the occupants, and then returns true. If the projectile did not pass through, and the building has to be damaged according to normal rules. the function returns false.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>true if the bullet passed through and the damage case was handled, otherwise false.</dd></dl>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Renegade </dd></dl>
<dl class="date" compact><dt><b>Date:</b></dt><dd>02.12.09+ </dd></dl>
<div class="fragment"><pre class="fragment"><a name="l00033"></a>00033                                        {
<a name="l00034"></a>00034         BulletClass* TheBullet = this-&gt;<a class="code" href="class_extension.html#72742b36a0db81d6697da473dfe8281d">AttachedToObject</a>;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036         <span class="keywordflow">if</span>(BuildingClass* Building = specific_cast&lt;BuildingClass *&gt; (TheBullet-&gt;Target)) { <span class="comment">// if that pointer is null, something went wrong</span>
<a name="l00037"></a>00037                 <a class="code" href="class_bullet_type_ext_1_1_ext_data.html">BulletTypeExt::ExtData</a>* TheBulletTypeExt = <a class="code" href="class_bullet_type_ext.html#7dc0a4583e92987bd0b670ed627aef26">BulletTypeExt::ExtMap</a>.<a class="code" href="class_container.html#90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(TheBullet-&gt;Type);
<a name="l00038"></a>00038                 <a class="code" href="class_building_type_ext_1_1_ext_data.html">BuildingTypeExt::ExtData</a>* BuildingAresData = <a class="code" href="class_building_type_ext.html#9643fa629dd6d2a20eeefa4942d8612a">BuildingTypeExt::ExtMap</a>.<a class="code" href="class_container.html#90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(Building-&gt;Type);
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="comment">/*</span>
<a name="l00041"></a>00041 <span class="comment">                Debug::Log("Bullet %s is about to damage occupants of %s: occupants #%d, UC.PT = %lf\n",</span>
<a name="l00042"></a>00042 <span class="comment">                        TheBullet-&gt;Type-&gt;ID, Building-&gt;Type-&gt;ID, Building-&gt;Occupants.Count, BuildingAresData-&gt;UCPassThrough);</span>
<a name="l00043"></a>00043 <span class="comment">*/</span>
<a name="l00044"></a>00044                 <span class="comment">// only work when UCPassThrough is set, as per community vote in thread #1392</span>
<a name="l00045"></a>00045                 <span class="keywordflow">if</span>(Building-&gt;Occupants.Count &amp;&amp; BuildingAresData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#4274f2da0b95141162610c3fddb409e8" title="How many percent of the shots pass through the building to the occupants? 0.0 = 0%...">UCPassThrough</a>) {
<a name="l00046"></a>00046                         Debug::Log(<span class="stringliteral">"SubjToTrenches = %d\n"</span>, TheBulletTypeExt-&gt;<a class="code" href="class_bullet_type_ext_1_1_ext_data.html#b91b332bbf0e909781282037bc5cbc1b">SubjectToTrenches</a>);
<a name="l00047"></a>00047                         <span class="comment">// test for !SubjectToTrenches because being SubjectToTrenches means "we're getting stopped by trenches".</span>
<a name="l00048"></a>00048                         <span class="keywordflow">if</span>(!TheBulletTypeExt-&gt;<a class="code" href="class_bullet_type_ext_1_1_ext_data.html#b91b332bbf0e909781282037bc5cbc1b">SubjectToTrenches</a>
<a name="l00049"></a>00049                                 || ((ScenarioClass::Instance-&gt;Random.RandomRanged(0, 99) / 100.0) &lt; BuildingAresData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#4274f2da0b95141162610c3fddb409e8" title="How many percent of the shots pass through the building to the occupants? 0.0 = 0%...">UCPassThrough</a>)) {
<a name="l00050"></a>00050                                 <span class="keywordtype">int</span> poorBastard = ScenarioClass::Instance-&gt;Random.RandomRanged(0, Building-&gt;Occupants.Count - 1); <span class="comment">// which Occupant is getting it?</span>
<a name="l00051"></a>00051                                 Debug::Log(<span class="stringliteral">"Poor Bastard #%d\n"</span>, poorBastard);
<a name="l00052"></a>00052                                 <span class="keywordflow">if</span>(BuildingAresData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#6cccf17f0703b5e5014e377bb5ebe9c4" title="Chance of an occupant getting killed instantly when a bullet passes through. 0.0...">UCFatalRate</a>
<a name="l00053"></a>00053                                         &amp;&amp; ((ScenarioClass::Instance-&gt;Random.RandomRanged(0, 99) / 100.0) &lt; BuildingAresData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#6cccf17f0703b5e5014e377bb5ebe9c4" title="Chance of an occupant getting killed instantly when a bullet passes through. 0.0...">UCFatalRate</a>)) {
<a name="l00054"></a>00054                                         Debug::Log(<span class="stringliteral">"Fatal hit!\n"</span>);
<a name="l00055"></a>00055                                         <span class="comment">// fatal hit</span>
<a name="l00056"></a>00056                                         Building-&gt;Occupants[poorBastard]-&gt;Destroyed(TheBullet-&gt;Owner);
<a name="l00057"></a>00057                                         Building-&gt;Occupants[poorBastard]-&gt;UnInit();
<a name="l00058"></a>00058                                         <span class="comment">// don't separate these two lines - poor guy's already ~dtor'd, but his pointer is still dangling from the vector</span>
<a name="l00059"></a>00059                                         Building-&gt;Occupants.RemoveItem(poorBastard);
<a name="l00060"></a>00060                                         Building-&gt;UpdateThreatInCell(Building-&gt;GetCell());
<a name="l00061"></a>00061                                 } <span class="keywordflow">else</span> {
<a name="l00062"></a>00062                                         <span class="comment">/* ReceiveDamage args:</span>
<a name="l00063"></a>00063 <span class="comment">                                        virtual eDamageState ReceiveDamage(int* pDamage, int DistanceFromEpicenter, WarheadTypeClass* pWH,</span>
<a name="l00064"></a>00064 <span class="comment">                                                ObjectClass* Attacker, bool IgnoreDefenses, bool PreventPassengerEscape, HouseClass* pAttackingHouse) R0;</span>
<a name="l00065"></a>00065 <span class="comment">                                                where</span>
<a name="l00066"></a>00066 <span class="comment">                                                DistanceFromEpicenter -&gt; used for CellSpread/PercentAtMax</span>
<a name="l00067"></a>00067 <span class="comment">                                                IgnoreDefenses -&gt; ignore Immune=yes</span>
<a name="l00068"></a>00068 <span class="comment">                                        */</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070                                         <span class="comment">// just a flesh wound</span>
<a name="l00071"></a>00071                                         Debug::Log(<span class="stringliteral">"Flesh wound - health(%d) * UCDmgMult(%lf)\n"</span>, TheBullet-&gt;Health, BuildingAresData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#96fa7c7c918cee22691ef5ce0762efcb" title="How many percent of normal damage are applied if an occupant is hit when a bullet...">UCDamageMultiplier</a>);
<a name="l00072"></a>00072                                         <span class="comment">// Bullet-&gt;Health is the damage it delivers (go Westwood)</span>
<a name="l00073"></a>00073                                         <span class="keywordtype">int</span> adjustedDamage = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span> (ceil(TheBullet-&gt;Health * BuildingAresData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#96fa7c7c918cee22691ef5ce0762efcb" title="How many percent of normal damage are applied if an occupant is hit when a bullet...">UCDamageMultiplier</a>));
<a name="l00074"></a>00074                                         Debug::Log(<span class="stringliteral">"Adjusted damage = %d\n"</span>, adjustedDamage);
<a name="l00075"></a>00075                                         <span class="keywordtype">int</span> result = Building-&gt;Occupants[poorBastard]-&gt;ReceiveDamage(&amp;adjustedDamage, 0, TheBullet-&gt;WH,
<a name="l00076"></a>00076                                                                 TheBullet-&gt;Owner, <span class="keyword">false</span>, <span class="keyword">true</span>, TheBullet-&gt;GetOwningHouse());
<a name="l00077"></a>00077                                         Debug::Log(<span class="stringliteral">"Received damage, %d\n"</span>, result);
<a name="l00078"></a>00078                                 }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080                                 <span class="comment">// BuildingAresData is for the BuildingType for some reason, so we need a new Ext var</span>
<a name="l00081"></a>00081                                 <a class="code" href="class_building_ext_1_1_ext_data.html">BuildingExt::ExtData</a>* SpecificBuildingExt = <a class="code" href="class_building_ext.html#bae25aca766faa296092dea1dc69cff7">BuildingExt::ExtMap</a>.<a class="code" href="class_container.html#90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(Building);
<a name="l00082"></a>00082                                 <span class="comment">// if the last occupant was killed and this building was raided, it needs to be returned to its owner. (Bug #700)</span>
<a name="l00083"></a>00083                                 SpecificBuildingExt-&gt;<a class="code" href="class_building_ext_1_1_ext_data.html#29586d61b4f18e7fd044e0dd5e10c946" title="Checks if the building is empty but still marked as raided, and returns the building...">evalRaidStatus</a>();
<a name="l00084"></a>00084                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00085"></a>00085                         } <span class="keywordflow">else</span> {
<a name="l00086"></a>00086                                 <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// no damage dealt b/c bullet was SubjectToTrenches=yes and UC.PassThrough did not apply</span>
<a name="l00087"></a>00087                         }
<a name="l00088"></a>00088                 } <span class="keywordflow">else</span> {
<a name="l00089"></a>00089                         <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// no damage dealt b/c either there were no occupants, or UC.PassThrough is set to 0</span>
<a name="l00090"></a>00090                 }
<a name="l00091"></a>00091         } <span class="keywordflow">else</span> {
<a name="l00092"></a>00092                 <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// no damage dealt b/c the building-pointer was NULL (which is concerning)</span>
<a name="l00093"></a>00093         }
<a name="l00094"></a>00094 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="990f09b1655f70efb5b746852f676442"></a><!-- doxytag: member="BulletExt::ExtData::InvalidatePointer" ref="990f09b1655f70efb5b746852f676442" args="(void *ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void BulletExt::BulletExt::ExtData::InvalidatePointer           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ptr</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Implements <a class="el" href="class_extension.html#9e6b2ac570eddadb2ca3c01668da88b8">Extension&lt; TT &gt;</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00034"></a>00034                                                           {
<a name="l00035"></a>00035                 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="12b7a9fd2c818556e3dc259463ee759e"></a><!-- doxytag: member="BulletExt::ExtData::Size" ref="12b7a9fd2c818556e3dc259463ee759e" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual size_t BulletExt::BulletExt::ExtData::Size           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Implements <a class="el" href="class_extension.html#44ddedd12613b24b7b03d21982782047">Extension&lt; TT &gt;</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00030"></a>00030 { <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(*this); };
</pre></div>
<p>

</div>
</div><p>
<hr>The documentation for this class was generated from the following files:<ul>
<li>Ext/Bullet/<a class="el" href="_bullet_2_body_8h.html">Body.h</a><li>Ext/Bullet/<a class="el" href="_bullet_2_body_8cpp.html">Body.cpp</a></ul>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat May 29 11:15:58 2010 for Ares by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
