<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ares: Helpers::Alex Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="class_helpers.html">Helpers</a>::<a class="el" href="class_helpers_1_1_alex.html">Alex</a>
  </div>
</div>
<div class="contents">
<h1>Helpers::Alex Class Reference</h1><!-- doxytag: class="Helpers::Alex" -->
<p><code>#include &lt;Utilities/Helpers.Alex.h&gt;</code></p>

<p><a href="class_helpers_1_1_alex-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_helpers_1_1_alex.html#abcd04535bb1fcd3e68d8de7b8bd22044">getCappedDuration</a> (int CurrentValue, int Duration, int Cap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Gets the new duration a stackable or absolute effect will last.  <a href="#abcd04535bb1fcd3e68d8de7b8bd22044"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static DynamicVectorClass<br class="typebreak"/>
&lt; TechnoClass * &gt; *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_helpers_1_1_alex.html#a1bf422e766e7704df99f1c27de3fc6ca">getCellSpreadItems</a> (CoordStruct *coords, float spread, bool includeInAir=false)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Gets a list of all units in range of a cell spread weapon.  <a href="#a1bf422e766e7704df99f1c27de3fc6ca"></a><br/></td></tr>
</table>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="abcd04535bb1fcd3e68d8de7b8bd22044"></a><!-- doxytag: member="Helpers::Alex::getCappedDuration" ref="abcd04535bb1fcd3e68d8de7b8bd22044" args="(int CurrentValue, int Duration, int Cap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int Helpers::Alex::getCappedDuration </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>CurrentValue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>Duration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>Cap</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Gets the new duration a stackable or absolute effect will last. </p>
<p>The new frames count is calculated the following way:</p>
<p>If Duration is positive it will inflict damage. If Cap is larger than zero, the maximum amount of frames will be defined by Cap. If the current value already is larger than that, in will not be reduced. If Cap is zero, then the duration can add up infinitely. If Cap is less than zero, duration will be set to Duration, if the current value is not higher already.</p>
<p>If Duration is negative, the effect will be reduced. A negative Cap reduces the current value by Duration. A positive or zero Cap will do the same, but additionally shorten it to Cap if the result would be higher than that. Thus, a Cap of zero removes the current effect altogether.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>CurrentValue</em>&nbsp;</td><td>The Technos current remaining time. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Duration</em>&nbsp;</td><td>The duration the effect uses. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Cap</em>&nbsp;</td><td>The maximum Duration this effect can cause.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The new effect frames count.</dd></dl>
<dl class="author"><dt><b>Author:</b></dt><dd>AlexB </dd></dl>
<dl class="date"><dt><b>Date:</b></dt><dd>2010-04-27 </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00034"></a>00034                                                                                       {
<a name="l00035"></a>00035                         <span class="comment">// Usually, the new duration is just added.</span>
<a name="l00036"></a>00036                         <span class="keywordtype">int</span> ProposedDuration = CurrentValue + Duration;
<a name="l00037"></a>00037 
<a name="l00038"></a>00038                         <span class="keywordflow">if</span> (Duration &gt; 0) {
<a name="l00039"></a>00039                                 <span class="comment">// Positive damage.</span>
<a name="l00040"></a>00040                                 <span class="keywordflow">if</span> (Cap &lt; 0) {
<a name="l00041"></a>00041                                         <span class="comment">// Do not stack. Use the maximum value.</span>
<a name="l00042"></a>00042                                         <span class="keywordflow">return</span> std::max(Duration, CurrentValue);
<a name="l00043"></a>00043                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Cap &gt; 0) {
<a name="l00044"></a>00044                                         <span class="comment">// Cap the duration.</span>
<a name="l00045"></a>00045                                         <span class="keywordtype">int</span> cappedValue = std::min(ProposedDuration, Cap);
<a name="l00046"></a>00046                                         <span class="keywordflow">return</span> std::max(CurrentValue, cappedValue);
<a name="l00047"></a>00047                                 } <span class="keywordflow">else</span> {
<a name="l00048"></a>00048                                         <span class="comment">// There is no cap. Allow the duration to stack up.</span>
<a name="l00049"></a>00049                                         <span class="keywordflow">return</span> ProposedDuration;
<a name="l00050"></a>00050                                 }
<a name="l00051"></a>00051                         } <span class="keywordflow">else</span> {
<a name="l00052"></a>00052                                 <span class="comment">// Negative damage.</span>
<a name="l00053"></a>00053                                 <span class="keywordflow">return</span> (Cap &lt; 0 ? ProposedDuration : std::min(ProposedDuration, Cap));
<a name="l00054"></a>00054                         }
<a name="l00055"></a>00055                 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1bf422e766e7704df99f1c27de3fc6ca"></a><!-- doxytag: member="Helpers::Alex::getCellSpreadItems" ref="a1bf422e766e7704df99f1c27de3fc6ca" args="(CoordStruct *coords, float spread, bool includeInAir=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DynamicVectorClass&lt;TechnoClass*&gt;* Helpers::Alex::getCellSpreadItems </td>
          <td>(</td>
          <td class="paramtype">CoordStruct *&nbsp;</td>
          <td class="paramname"> <em>coords</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>spread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>includeInAir</em> = <code>false</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Gets a list of all units in range of a cell spread weapon. </p>
<p>CellSpread is handled as described in <a href="http://modenc.renegadeprojects.com/CellSpread.">http://modenc.renegadeprojects.com/CellSpread.</a></p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>coords</em>&nbsp;</td><td>The location the projectile detonated. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>spread</em>&nbsp;</td><td>The range to find items in. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>includeInAir</em>&nbsp;</td><td>Include items that are currently InAir.</td></tr>
  </table>
  </dd>
</dl>
<dl class="author"><dt><b>Author:</b></dt><dd>AlexB </dd></dl>
<dl class="date"><dt><b>Date:</b></dt><dd>2010-06-28 </dd></dl>

<p><div class="fragment"><pre class="fragment"><a name="l00069"></a>00069                                                                                                                                         {
<a name="l00070"></a>00070                         <span class="comment">// set of possibly affected objects. every object can be here only once.</span>
<a name="l00071"></a>00071                         std::set&lt;TechnoClass*&gt; *<span class="keyword">set</span> = <span class="keyword">new</span> std::set&lt;TechnoClass*&gt;();
<a name="l00072"></a>00072 
<a name="l00073"></a>00073                         <span class="comment">// the quick way. only look at stuff residing on the very cells we are affecting.</span>
<a name="l00074"></a>00074                         CellStruct cellCoords = MapClass::Instance-&gt;GetCellAt(coords)-&gt;MapCoords;
<a name="l00075"></a>00075                         <span class="keywordtype">int</span> countCells = CellSpread::NumCells((<span class="keywordtype">int</span>)(spread + 0.99));
<a name="l00076"></a>00076                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; countCells; ++i) {
<a name="l00077"></a>00077                                 CellStruct tmpCell = CellSpread::GetCell(i);
<a name="l00078"></a>00078                                 tmpCell += cellCoords;
<a name="l00079"></a>00079                                 CellClass *c = MapClass::Instance-&gt;GetCellAt(&amp;tmpCell);
<a name="l00080"></a>00080                                 <span class="keywordflow">for</span>(ObjectClass *curObj = c-&gt;GetContent(); curObj; curObj = curObj-&gt;NextObject) {
<a name="l00081"></a>00081                                         <span class="keywordflow">if</span>(TechnoClass *Techno = generic_cast&lt;TechnoClass*&gt;(curObj)) {
<a name="l00082"></a>00082                                                 <span class="keyword">set</span>-&gt;insert(Techno);
<a name="l00083"></a>00083                                         }
<a name="l00084"></a>00084                                 }
<a name="l00085"></a>00085                         }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087                         <span class="comment">// flying objects are not included normally</span>
<a name="l00088"></a>00088                         <span class="keywordflow">if</span>(includeInAir) {
<a name="l00089"></a>00089                                 <span class="comment">// the not quite so fast way. skip everything not in the air.</span>
<a name="l00090"></a>00090                                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;TechnoClass::Array-&gt;Count; ++i) {
<a name="l00091"></a>00091                                         TechnoClass *Techno = TechnoClass::Array-&gt;GetItem(i);
<a name="l00092"></a>00092                                         <span class="keywordflow">if</span>(Techno-&gt;IsInAir()) {
<a name="l00093"></a>00093                                                 <span class="comment">// rough estimation</span>
<a name="l00094"></a>00094                                                 <span class="keywordflow">if</span>(Techno-&gt;Location.DistanceFrom(*coords) &lt;= spread * 256) {
<a name="l00095"></a>00095                                                         <span class="keyword">set</span>-&gt;insert(Techno);
<a name="l00096"></a>00096                                                 }
<a name="l00097"></a>00097                                         }
<a name="l00098"></a>00098                                 }
<a name="l00099"></a>00099                         }
<a name="l00100"></a>00100 
<a name="l00101"></a>00101                         <span class="comment">// look closer. the final selection. put all affected items in a vector.</span>
<a name="l00102"></a>00102                         DynamicVectorClass&lt;TechnoClass*&gt; *ret = <span class="keyword">new</span> DynamicVectorClass&lt;TechnoClass*&gt;();
<a name="l00103"></a>00103                         <span class="keywordflow">for</span>(std::set&lt;TechnoClass*&gt;::iterator iterator = set-&gt;begin(); iterator != <span class="keyword">set</span>-&gt;end(); iterator++) {
<a name="l00104"></a>00104                                 TechnoClass *Techno = *iterator;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106                                 <span class="comment">// ignore buildings that are not visible, like ambient light posts</span>
<a name="l00107"></a>00107                                 <span class="keywordflow">if</span>(BuildingTypeClass *BT = specific_cast&lt;BuildingTypeClass*&gt;(Techno-&gt;GetTechnoType())) {
<a name="l00108"></a>00108                                         <span class="keywordflow">if</span>(BT-&gt;InvisibleInGame) {
<a name="l00109"></a>00109                                                 <span class="keywordflow">continue</span>;
<a name="l00110"></a>00110                                         }
<a name="l00111"></a>00111                                 }
<a name="l00112"></a>00112 
<a name="l00113"></a>00113                                 <span class="comment">// get distance from impact site</span>
<a name="l00114"></a>00114                                 CoordStruct target;
<a name="l00115"></a>00115                                 Techno-&gt;GetCoords(&amp;target);
<a name="l00116"></a>00116                                 <span class="keywordtype">double</span> dist = target.DistanceFrom(*coords);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118                                 <span class="comment">// reduce the distance for flying aircraft</span>
<a name="l00119"></a>00119                                 <span class="keywordflow">if</span>((Techno-&gt;WhatAmI() == abs_Aircraft) &amp;&amp; Techno-&gt;IsInAir()) {
<a name="l00120"></a>00120                                         dist *= 0.5;
<a name="l00121"></a>00121                                 }
<a name="l00122"></a>00122 
<a name="l00123"></a>00123                                 <span class="comment">// this is good</span>
<a name="l00124"></a>00124                                 <span class="keywordflow">if</span>(dist &lt;= spread * 256) {
<a name="l00125"></a>00125                                         ret-&gt;AddItem(Techno);
<a name="l00126"></a>00126                                 }
<a name="l00127"></a>00127                         }
<a name="l00128"></a>00128 
<a name="l00129"></a>00129                         <span class="comment">// tidy up</span>
<a name="l00130"></a>00130                         <span class="keyword">set</span>-&gt;clear();
<a name="l00131"></a>00131                         <span class="keyword">delete</span> <span class="keyword">set</span>;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133                         <span class="keywordflow">return</span> ret;
<a name="l00134"></a>00134                 }
</pre></div></p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>Utilities/<a class="el" href="_helpers_8_alex_8h.html">Helpers.Alex.h</a></li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue Dec 14 21:10:40 2010 for Ares by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
