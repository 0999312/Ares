<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Ares: BuildingExt::BuildingExt::ExtData Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="class_building_ext.html">BuildingExt</a>::<a class="el" href="class_building_ext_1_1_ext_data.html">ExtData</a>
  </div>
</div>
<div class="contents">
<h1>BuildingExt::BuildingExt::ExtData Class Reference</h1><!-- doxytag: class="BuildingExt::ExtData" --><!-- doxytag: inherits="Extension&lt; TT &gt;" --><code>#include &lt;Ext/Building/Body.h&gt;</code>
<p>
<div class="dynheader">
Inheritance diagram for BuildingExt::BuildingExt::ExtData:</div>
<div class="dynsection">

<p><center><img src="class_building_ext_1_1_ext_data.png" usemap="#BuildingExt::BuildingExt::ExtData_map" border="0" alt=""></center>
<map name="BuildingExt::BuildingExt::ExtData_map">
<area href="class_extension.html" alt="Extension< TT >" shape="rect" coords="0,0,191,24">
</map>
</div>

<p>
<a href="class_building_ext_1_1_ext_data-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#a7ed6b57d9858d56794f68f80a69fb40">InfiltratedBy</a> (HouseClass *Enterer)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#36abc8490d38f5f8105f29c138f0d958">ExtData</a> (const DWORD <a class="el" href="class_extension.html#2f0c543d5bceafd46d103be4f87a5abe">Canary</a>, <a class="el" href="class_building_ext.html#66c50954e22686f620bf9dd86ec856b9">TT</a> *const OwnerObject)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#8f35ebea78f8e076e47f9caf2324ac74">~ExtData</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#d63c5123584319b1984524dc5b758c04">Size</a> () const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#4918704e582482416d8a6a0232bd3e93">InvalidatePointer</a> (void *ptr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#21d04400f5987ecf67d56b132700b063">RubbleYell</a> (bool beingRepaired=false)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function switches the building into its Advanced Rubble state or back to normal.  <a href="#21d04400f5987ecf67d56b132700b063"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#fc818dee964beb1c3e2fb17390df15c6">canTraverseTo</a> (BuildingClass *targetBuilding)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if occupants of the current building can, on principle, move on to the target building.  <a href="#fc818dee964beb1c3e2fb17390df15c6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#17b1563086581584c3e904e168506636">doTraverseTo</a> (BuildingClass *targetBuilding)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function moves as many occupants as possible from the current to the target building.  <a href="#17b1563086581584c3e904e168506636"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#e4a73a7dee4d4ffb1e68a2aa3355ef6f">sameTrench</a> (BuildingClass *targetBuilding)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if the current and the target building are both of the same trench kind.  <a href="#e4a73a7dee4d4ffb1e68a2aa3355ef6f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#7523847404477cd1be29ab2f403d4fb3">isLinkable</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns true if this is a structure that can be linked to other structures, like a wall, fence, or trench. This is used to quick-check if the game has to look for linkable buildings in the first place.  <a href="#7523847404477cd1be29ab2f403d4fb3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#63d2873ee89296616c24bc3a440819d1">canLinkTo</a> (BuildingClass *targetBuilding)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks if the current building can link to the given target building.  <a href="#63d2873ee89296616c24bc3a440819d1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#29586d61b4f18e7fd044e0dd5e10c946">evalRaidStatus</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks if the building is empty but still marked as raided, and returns the building to its previous owner, if so.  <a href="#29586d61b4f18e7fd044e0dd5e10c946"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#93ddc852a6c29c34bc69d746797ecae5">UpdateFirewall</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#38ded93820573fc9f724e4aadbc49bcb">ImmolateVictims</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#cddab0e7650f1f9ee19e04399a2a8be6">ImmolateVictim</a> (ObjectClass *Victim)</td></tr>

<tr><td colspan="2"><br><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">HouseClass *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#7270bd5eb03823bf3ed264a38e645455">OwnerBeforeRaid</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Contains the house which owned this building prior to it being raided and turned over to the raiding party.  <a href="#7270bd5eb03823bf3ed264a38e645455"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#f8a542bf713fcbfc1bf81a7cfa5ed2c1">isCurrentlyRaided</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Whether this building is currently occupied by someone not the actual owner of the structure.  <a href="#f8a542bf713fcbfc1bf81a7cfa5ed2c1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#7979cb23cb460430680ac03b35ca23f1">ignoreNextEVA</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This is used when returning raided buildings, to decide whether to play EVA announcements about building capture.  <a href="#7979cb23cb460430680ac03b35ca23f1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_building_ext_1_1c_prism_forwarding.html">cPrismForwarding</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_building_ext_1_1_ext_data.html#17fa3d91f003a8ec0e48bed89bfb1ca2">PrismForwarding</a></td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="36abc8490d38f5f8105f29c138f0d958"></a><!-- doxytag: member="BuildingExt::ExtData::ExtData" ref="36abc8490d38f5f8105f29c138f0d958" args="(const DWORD Canary, TT *const OwnerObject)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BuildingExt::BuildingExt::ExtData::ExtData           </td>
          <td>(</td>
          <td class="paramtype">const DWORD&nbsp;</td>
          <td class="paramname"> <em>Canary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_building_ext.html#66c50954e22686f620bf9dd86ec856b9">TT</a> *const &nbsp;</td>
          <td class="paramname"> <em>OwnerObject</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00045"></a>00045                                                                    : <a class="code" href="class_extension.html">Extension&lt;TT&gt;</a>(<a class="code" href="class_extension.html#2f0c543d5bceafd46d103be4f87a5abe">Canary</a>, OwnerObject),
<a name="l00046"></a>00046                         <a class="code" href="class_building_ext_1_1_ext_data.html#7270bd5eb03823bf3ed264a38e645455" title="Contains the house which owned this building prior to it being raided and turned...">OwnerBeforeRaid</a>(NULL), <a class="code" href="class_building_ext_1_1_ext_data.html#f8a542bf713fcbfc1bf81a7cfa5ed2c1" title="Whether this building is currently occupied by someone not the actual owner of the...">isCurrentlyRaided</a>(<span class="keyword">false</span>), <a class="code" href="class_building_ext_1_1_ext_data.html#7979cb23cb460430680ac03b35ca23f1" title="This is used when returning raided buildings, to decide whether to play EVA announcements...">ignoreNextEVA</a>(<span class="keyword">false</span>), <a class="code" href="class_building_ext_1_1_ext_data.html#17fa3d91f003a8ec0e48bed89bfb1ca2">PrismForwarding</a>()
<a name="l00047"></a>00047                         { };
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8f35ebea78f8e076e47f9caf2324ac74"></a><!-- doxytag: member="BuildingExt::ExtData::~ExtData" ref="8f35ebea78f8e076e47f9caf2324ac74" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual BuildingExt::BuildingExt::ExtData::~ExtData           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00049"></a>00049                                    {
<a name="l00050"></a>00050                 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="63d2873ee89296616c24bc3a440819d1"></a><!-- doxytag: member="BuildingExt::ExtData::canLinkTo" ref="63d2873ee89296616c24bc3a440819d1" args="(BuildingClass *targetBuilding)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool BuildingExt::BuildingExt::ExtData::canLinkTo           </td>
          <td>(</td>
          <td class="paramtype">BuildingClass *&nbsp;</td>
          <td class="paramname"> <em>targetBuilding</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Checks if the current building can link to the given target building. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>targetBuilding</em>&nbsp;</td><td>the building to check for compatibility. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>true if the two buildings can be linked. </dd></dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="class_building_ext_1_1_ext_data.html#7523847404477cd1be29ab2f403d4fb3" title="Returns true if this is a structure that can be linked to other structures, like...">isLinkable()</a> </dd></dl>
<div class="fragment"><pre class="fragment"><a name="l00232"></a>00232                                                                 {
<a name="l00233"></a>00233         BuildingClass* currentBuilding = this-&gt;<a class="code" href="class_extension.html#72742b36a0db81d6697da473dfe8281d">AttachedToObject</a>;
<a name="l00234"></a>00234 
<a name="l00235"></a>00235         <span class="comment">// Different owners // and owners not allied</span>
<a name="l00236"></a>00236         <span class="keywordflow">if</span>((currentBuilding-&gt;Owner != targetBuilding-&gt;Owner) &amp;&amp; !currentBuilding-&gt;Owner-&gt;IsAlliedWith(targetBuilding-&gt;Owner)) { <span class="comment">//&lt;-- see thread 1424</span>
<a name="l00237"></a>00237                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240         <a class="code" href="class_building_type_ext_1_1_ext_data.html">BuildingTypeExt::ExtData</a>* currentTypeExtData = <a class="code" href="class_building_type_ext.html#9643fa629dd6d2a20eeefa4942d8612a">BuildingTypeExt::ExtMap</a>.<a class="code" href="class_container.html#90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(currentBuilding-&gt;Type);
<a name="l00241"></a>00241         <a class="code" href="class_building_type_ext_1_1_ext_data.html">BuildingTypeExt::ExtData</a>* targetTypeExtData = <a class="code" href="class_building_type_ext.html#9643fa629dd6d2a20eeefa4942d8612a">BuildingTypeExt::ExtMap</a>.<a class="code" href="class_container.html#90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(targetBuilding-&gt;Type);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243         <span class="comment">// Firewalls</span>
<a name="l00244"></a>00244         <span class="keywordflow">if</span>(currentTypeExtData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#51503707d3c7be1bcd829f893acdd21e">Firewall_Is</a> &amp;&amp; targetTypeExtData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#51503707d3c7be1bcd829f893acdd21e">Firewall_Is</a>) {
<a name="l00245"></a>00245                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00246"></a>00246         }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248         <span class="comment">// Trenches</span>
<a name="l00249"></a>00249         <span class="keywordflow">if</span>(this-&gt;<a class="code" href="class_building_ext_1_1_ext_data.html#e4a73a7dee4d4ffb1e68a2aa3355ef6f" title="This function checks if the current and the target building are both of the same...">sameTrench</a>(targetBuilding)) {
<a name="l00250"></a>00250                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00251"></a>00251         }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00254"></a>00254 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="fc818dee964beb1c3e2fb17390df15c6"></a><!-- doxytag: member="BuildingExt::ExtData::canTraverseTo" ref="fc818dee964beb1c3e2fb17390df15c6" args="(BuildingClass *targetBuilding)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool BuildingExt::BuildingExt::ExtData::canTraverseTo           </td>
          <td>(</td>
          <td class="paramtype">BuildingClass *&nbsp;</td>
          <td class="paramname"> <em>targetBuilding</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if occupants of the current building can, on principle, move on to the target building. 
<p>
Conditions checked are whether there are occupants in the current building, whether the target building is full, whether the current building even is a trench, and whether both buildings are of the same trench kind.<p>
The current system assumes 1x1 sized trench parts; it will probably work in all cases where the 0,0 (top) cells of buildings touch (e.g. a 3x3 building next to a 1x3 building), but not when the 0,0 cells are further apart. This may be changed at a later point in time, if there is demand for it.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>targetBuilding</em>&nbsp;</td><td>a pointer to the target building. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>true if traversal between both buildings is legal, otherwise false. </dd></dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="class_building_ext_1_1_ext_data.html#17b1563086581584c3e904e168506636" title="This function moves as many occupants as possible from the current to the target...">doTraverseTo()</a></dd></dl>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Renegade </dd></dl>
<dl class="date" compact><dt><b>Date:</b></dt><dd>16.12.09+ </dd></dl>
<div class="fragment"><pre class="fragment"><a name="l00153"></a>00153                                                                     {
<a name="l00154"></a>00154         BuildingClass* currentBuilding = this-&gt;<a class="code" href="class_extension.html#72742b36a0db81d6697da473dfe8281d">AttachedToObject</a>;
<a name="l00155"></a>00155         <span class="comment">//BuildingTypeClass* currentBuildingType = game_cast&lt;BuildingTypeClass *&gt;(currentBuilding-&gt;GetTechnoType());</span>
<a name="l00156"></a>00156         BuildingTypeClass* targetBuildingType = targetBuilding-&gt;Type;
<a name="l00157"></a>00157 
<a name="l00158"></a>00158         <span class="keywordflow">if</span>((targetBuilding == currentBuilding)
<a name="l00159"></a>00159                 || (targetBuilding-&gt;Occupants.Count &gt;= targetBuildingType-&gt;MaxNumberOccupants)
<a name="l00160"></a>00160                 || !currentBuilding-&gt;Occupants.Count
<a name="l00161"></a>00161                 || !targetBuildingType-&gt;CanBeOccupied) { <span class="comment">// I'm a little if-clause short and stdout... // beat you to the punchline -- D</span>
<a name="l00162"></a>00162                 <span class="comment">// Can't traverse if there's no one to move, or the target is full, we can't actually occupy the target,</span>
<a name="l00163"></a>00163                 <span class="comment">// or if it's actually the same building</span>
<a name="l00164"></a>00164                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166 
<a name="l00167"></a>00167         <a class="code" href="class_building_type_ext_1_1_ext_data.html">BuildingTypeExt::ExtData</a>* currentBuildingTypeExt = <a class="code" href="class_building_type_ext.html#9643fa629dd6d2a20eeefa4942d8612a">BuildingTypeExt::ExtMap</a>.<a class="code" href="class_container.html#90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(currentBuilding-&gt;Type);
<a name="l00168"></a>00168         <a class="code" href="class_building_type_ext_1_1_ext_data.html">BuildingTypeExt::ExtData</a>* targetBuildingTypeExt = <a class="code" href="class_building_type_ext.html#9643fa629dd6d2a20eeefa4942d8612a">BuildingTypeExt::ExtMap</a>.<a class="code" href="class_container.html#90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(targetBuilding-&gt;Type);
<a name="l00169"></a>00169 
<a name="l00170"></a>00170         <span class="keywordflow">if</span>(this-&gt;<a class="code" href="class_building_ext_1_1_ext_data.html#e4a73a7dee4d4ffb1e68a2aa3355ef6f" title="This function checks if the current and the target building are both of the same...">sameTrench</a>(targetBuilding)) {
<a name="l00171"></a>00171                 <span class="comment">// if we've come here, there's room, there are people to move, and the buildings are trenches and of the same kind</span>
<a name="l00172"></a>00172                 <span class="comment">// the only questioning remaining is whether they are next to each other.</span>
<a name="l00173"></a>00173                 <span class="comment">// if the target building is more than 256 leptons away, it's not on a straight neighboring cell.</span>
<a name="l00174"></a>00174                 <span class="keywordflow">return</span> targetBuilding-&gt;Location.DistanceFrom(currentBuilding-&gt;Location) &lt;= 256.0;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176         } <span class="keywordflow">else</span> {
<a name="l00177"></a>00177                 <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// not the same trench kind or not a trench</span>
<a name="l00178"></a>00178         }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="17b1563086581584c3e904e168506636"></a><!-- doxytag: member="BuildingExt::ExtData::doTraverseTo" ref="17b1563086581584c3e904e168506636" args="(BuildingClass *targetBuilding)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BuildingExt::BuildingExt::ExtData::doTraverseTo           </td>
          <td>(</td>
          <td class="paramtype">BuildingClass *&nbsp;</td>
          <td class="paramname"> <em>targetBuilding</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function moves as many occupants as possible from the current to the target building. 
<p>
This function will move occupants from the current building to the target building until either a) the target building is full, or b) the current building is empty.<p>
<dl class="warning" compact><dt><b>Warning:</b></dt><dd>The function assumes the legality of the traversal was checked beforehand with <a class="el" href="class_building_ext_1_1_ext_data.html#fc818dee964beb1c3e2fb17390df15c6" title="This function checks if occupants of the current building can, on principle, move...">canTraverseTo()</a>, and will therefore not do any safety checks.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>targetBuilding</em>&nbsp;</td><td>a pointer to the target building. </td></tr>
  </table>
</dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="class_building_ext_1_1_ext_data.html#fc818dee964beb1c3e2fb17390df15c6" title="This function checks if occupants of the current building can, on principle, move...">canTraverseTo()</a></dd></dl>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Renegade </dd></dl>
<dl class="date" compact><dt><b>Date:</b></dt><dd>16.12.09+ </dd></dl>
<div class="fragment"><pre class="fragment"><a name="l00197"></a>00197                                                                    {
<a name="l00198"></a>00198         BuildingClass* currentBuilding = this-&gt;<a class="code" href="class_extension.html#72742b36a0db81d6697da473dfe8281d">AttachedToObject</a>;
<a name="l00199"></a>00199         BuildingTypeClass* targetBuildingType = targetBuilding-&gt;Type;
<a name="l00200"></a>00200 
<a name="l00201"></a>00201         <span class="comment">// depending on Westwood's handling, this could explode when Size &gt; 1 units are involved...but don't tell the users that</span>
<a name="l00202"></a>00202         <span class="keywordflow">while</span>(currentBuilding-&gt;Occupants.Count &amp;&amp; (targetBuilding-&gt;Occupants.Count &lt; targetBuildingType-&gt;MaxNumberOccupants)) {
<a name="l00203"></a>00203                 targetBuilding-&gt;Occupants.AddItem(currentBuilding-&gt;Occupants.GetItem(0));
<a name="l00204"></a>00204                 currentBuilding-&gt;Occupants.RemoveItem(0); <span class="comment">// maybe switch Add/Remove if the game gets pissy about multiple of them walking around</span>
<a name="l00205"></a>00205         }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207         this-&gt;<a class="code" href="class_building_ext_1_1_ext_data.html#29586d61b4f18e7fd044e0dd5e10c946" title="Checks if the building is empty but still marked as raided, and returns the building...">evalRaidStatus</a>(); <span class="comment">// if the traversal emptied the current building, it'll have to be returned to its owner</span>
<a name="l00208"></a>00208 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="29586d61b4f18e7fd044e0dd5e10c946"></a><!-- doxytag: member="BuildingExt::ExtData::evalRaidStatus" ref="29586d61b4f18e7fd044e0dd5e10c946" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BuildingExt::BuildingExt::ExtData::evalRaidStatus           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Checks if the building is empty but still marked as raided, and returns the building to its previous owner, if so. 
<p>
<div class="fragment"><pre class="fragment"><a name="l00210"></a>00210                                         {
<a name="l00211"></a>00211         <span class="comment">// if the building is still marked as raided, but unoccupied, return it to its previous owner</span>
<a name="l00212"></a>00212         <span class="keywordflow">if</span>(this-&gt;<a class="code" href="class_building_ext_1_1_ext_data.html#f8a542bf713fcbfc1bf81a7cfa5ed2c1" title="Whether this building is currently occupied by someone not the actual owner of the...">isCurrentlyRaided</a> &amp;&amp; !this-&gt;<a class="code" href="class_extension.html#72742b36a0db81d6697da473dfe8281d">AttachedToObject</a>-&gt;Occupants.Count) {
<a name="l00213"></a>00213                 <span class="comment">// Fix for #838: Only return the building to the previous owner if he hasn't been defeated</span>
<a name="l00214"></a>00214                 <span class="keywordflow">if</span>(!this-&gt;<a class="code" href="class_building_ext_1_1_ext_data.html#7270bd5eb03823bf3ed264a38e645455" title="Contains the house which owned this building prior to it being raided and turned...">OwnerBeforeRaid</a>-&gt;Defeated) {
<a name="l00215"></a>00215                         this-&gt;<a class="code" href="class_building_ext_1_1_ext_data.html#7979cb23cb460430680ac03b35ca23f1" title="This is used when returning raided buildings, to decide whether to play EVA announcements...">ignoreNextEVA</a> = <span class="keyword">true</span>; <span class="comment">// #698 - used in BuildingClass_ChangeOwnership_TrenchEVA to override EVA announcement</span>
<a name="l00216"></a>00216                         this-&gt;<a class="code" href="class_extension.html#72742b36a0db81d6697da473dfe8281d">AttachedToObject</a>-&gt;SetOwningHouse(this-&gt;<a class="code" href="class_building_ext_1_1_ext_data.html#7270bd5eb03823bf3ed264a38e645455" title="Contains the house which owned this building prior to it being raided and turned...">OwnerBeforeRaid</a>);
<a name="l00217"></a>00217                 }
<a name="l00218"></a>00218                 this-&gt;<a class="code" href="class_building_ext_1_1_ext_data.html#7270bd5eb03823bf3ed264a38e645455" title="Contains the house which owned this building prior to it being raided and turned...">OwnerBeforeRaid</a> = NULL;
<a name="l00219"></a>00219                 this-&gt;<a class="code" href="class_building_ext_1_1_ext_data.html#f8a542bf713fcbfc1bf81a7cfa5ed2c1" title="Whether this building is currently occupied by someone not the actual owner of the...">isCurrentlyRaided</a> = <span class="keyword">false</span>;
<a name="l00220"></a>00220         }
<a name="l00221"></a>00221 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="cddab0e7650f1f9ee19e04399a2a8be6"></a><!-- doxytag: member="BuildingExt::ExtData::ImmolateVictim" ref="cddab0e7650f1f9ee19e04399a2a8be6" args="(ObjectClass *Victim)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BuildingExt::BuildingExt::ExtData::ImmolateVictim           </td>
          <td>(</td>
          <td class="paramtype">ObjectClass *&nbsp;</td>
          <td class="paramname"> <em>Victim</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00625"></a>00625                                                             {
<a name="l00626"></a>00626         BuildingClass *pThis = this-&gt;<a class="code" href="class_extension.html#72742b36a0db81d6697da473dfe8281d">AttachedToObject</a>;
<a name="l00627"></a>00627         <span class="keywordflow">if</span>(generic_cast&lt;TechnoClass *&gt;(Victim) &amp;&amp; Victim != pThis &amp;&amp; !Victim-&gt;InLimbo &amp;&amp; Victim-&gt;IsAlive &amp;&amp; Victim-&gt;Health) {
<a name="l00628"></a>00628                 CoordStruct XYZ;
<a name="l00629"></a>00629                 Victim-&gt;GetCoords(&amp;XYZ);
<a name="l00630"></a>00630                 <span class="keywordtype">int</span> Damage = Victim-&gt;Health;
<a name="l00631"></a>00631                 Victim-&gt;ReceiveDamage(&amp;Damage, 0, RulesClass::Instance-&gt;C4Warhead<span class="comment">/* todo */</span>, 0, 1, 0, pThis-&gt;Owner);
<a name="l00632"></a>00632 
<a name="l00633"></a>00633                 <span class="keywordflow">if</span>(AnimTypeClass *FSAnim = AnimTypeClass::Find(Victim-&gt;IsInAir() ? <span class="stringliteral">"FSAIR"</span> : <span class="stringliteral">"FSGRND"</span>)) {
<a name="l00634"></a>00634                         AnimClass * placeholder;
<a name="l00635"></a>00635                         GAME_ALLOC(AnimClass, placeholder, FSAnim, &amp;XYZ);
<a name="l00636"></a>00636                 }
<a name="l00637"></a>00637 
<a name="l00638"></a>00638         }
<a name="l00639"></a>00639 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="38ded93820573fc9f724e4aadbc49bcb"></a><!-- doxytag: member="BuildingExt::ExtData::ImmolateVictims" ref="38ded93820573fc9f724e4aadbc49bcb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BuildingExt::BuildingExt::ExtData::ImmolateVictims           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00618"></a>00618                                          {
<a name="l00619"></a>00619         CellClass *C = this-&gt;<a class="code" href="class_extension.html#72742b36a0db81d6697da473dfe8281d">AttachedToObject</a>-&gt;GetCell();
<a name="l00620"></a>00620         <span class="keywordflow">for</span>(ObjectClass *O = C-&gt;GetContent(); O; O = O-&gt;NextObject) {
<a name="l00621"></a>00621                 this-&gt;<a class="code" href="class_building_ext_1_1_ext_data.html#cddab0e7650f1f9ee19e04399a2a8be6">ImmolateVictim</a>(O);
<a name="l00622"></a>00622         }
<a name="l00623"></a>00623 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="a7ed6b57d9858d56794f68f80a69fb40"></a><!-- doxytag: member="BuildingExt::ExtData::InfiltratedBy" ref="a7ed6b57d9858d56794f68f80a69fb40" args="(HouseClass *Enterer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool BuildingExt::BuildingExt::ExtData::InfiltratedBy           </td>
          <td>(</td>
          <td class="paramtype">HouseClass *&nbsp;</td>
          <td class="paramname"> <em>Enterer</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00375"></a>00375                                                           {
<a name="l00376"></a>00376         BuildingClass *EnteredBuilding = this-&gt;<a class="code" href="class_extension.html#72742b36a0db81d6697da473dfe8281d">AttachedToObject</a>;
<a name="l00377"></a>00377         BuildingTypeClass *EnteredType = EnteredBuilding-&gt;Type;
<a name="l00378"></a>00378         HouseClass *Owner = EnteredBuilding-&gt;Owner;
<a name="l00379"></a>00379         <a class="code" href="class_building_type_ext_1_1_ext_data.html">BuildingTypeExt::ExtData</a>* pTypeExt = <a class="code" href="class_building_type_ext.html#9643fa629dd6d2a20eeefa4942d8612a">BuildingTypeExt::ExtMap</a>.<a class="code" href="class_container.html#90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(EnteredBuilding-&gt;Type);
<a name="l00380"></a>00380         <a class="code" href="class_house_ext_1_1_ext_data.html">HouseExt::ExtData</a>* pEntererExt = <a class="code" href="class_house_ext.html#4a73e500fabd21a7359c5247c31d4c03">HouseExt::ExtMap</a>.<a class="code" href="class_container.html#90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(Enterer);
<a name="l00381"></a>00381 
<a name="l00382"></a>00382         <span class="keywordflow">if</span>(!pTypeExt-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#5ab5a77414f1e6a8773e08f3934503bf">InfiltrateCustom</a>) {
<a name="l00383"></a>00383                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00384"></a>00384         }
<a name="l00385"></a>00385 
<a name="l00386"></a>00386         <span class="keywordflow">if</span>(Owner == Enterer) {
<a name="l00387"></a>00387                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00388"></a>00388         }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390         <span class="keywordtype">bool</span> raiseEva = <span class="keyword">false</span>;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392         <span class="keywordflow">if</span>(Enterer-&gt;ControlledByPlayer() || Owner-&gt;ControlledByPlayer()) {
<a name="l00393"></a>00393                 CellStruct xy;
<a name="l00394"></a>00394                 EnteredBuilding-&gt;GetMapCoords(&amp;xy);
<a name="l00395"></a>00395                 <span class="keywordflow">if</span>(RadarEventClass::Create(RADAREVENT_STRUCTUREINFILTRATED, xy)) {
<a name="l00396"></a>00396                         raiseEva = <span class="keyword">true</span>;
<a name="l00397"></a>00397                 }
<a name="l00398"></a>00398         }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400         <span class="keywordtype">bool</span> evaForOwner = Owner-&gt;ControlledByPlayer() &amp;&amp; raiseEva;
<a name="l00401"></a>00401         <span class="keywordtype">bool</span> evaForEnterer = Enterer-&gt;ControlledByPlayer() &amp;&amp; raiseEva;
<a name="l00402"></a>00402         <span class="keywordtype">bool</span> effectApplied = <span class="keyword">false</span>;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 
<a name="l00405"></a>00405         <span class="keywordflow">if</span>(pTypeExt-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#93e36f562c1c002d6be43e1e7cdc7dfe">ResetRadar</a>) {
<a name="l00406"></a>00406                 Owner-&gt;ReshroudMap();
<a name="l00407"></a>00407                 <span class="keywordflow">if</span>(!Owner-&gt;SpySatActive &amp;&amp; evaForOwner) {
<a name="l00408"></a>00408                         VoxClass::Play(<span class="stringliteral">"EVA_RadarSabotaged"</span>);
<a name="l00409"></a>00409                 }
<a name="l00410"></a>00410                 <span class="keywordflow">if</span>(!Enterer-&gt;SpySatActive &amp;&amp; evaForEnterer) {
<a name="l00411"></a>00411                         VoxClass::Play(<span class="stringliteral">"EVA_BuildingInfRadarSabotaged"</span>);
<a name="l00412"></a>00412                 }
<a name="l00413"></a>00413                 effectApplied = <span class="keyword">true</span>;
<a name="l00414"></a>00414         }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 
<a name="l00417"></a>00417         <span class="keywordflow">if</span>(pTypeExt-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#6d42dd7e2b0450e689a7084f2798abd4">PowerOutageDuration</a> &gt; 0) {
<a name="l00418"></a>00418                 Owner-&gt;CreatePowerOutage(pTypeExt-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#6d42dd7e2b0450e689a7084f2798abd4">PowerOutageDuration</a>);
<a name="l00419"></a>00419                 <span class="keywordflow">if</span>(evaForOwner) {
<a name="l00420"></a>00420                         VoxClass::Play(<span class="stringliteral">"EVA_PowerSabotaged"</span>);
<a name="l00421"></a>00421                 }
<a name="l00422"></a>00422                 <span class="keywordflow">if</span>(evaForEnterer) {
<a name="l00423"></a>00423                         VoxClass::Play(<span class="stringliteral">"EVA_BuildingInfiltrated"</span>);
<a name="l00424"></a>00424                         VoxClass::Play(<span class="stringliteral">"EVA_EnemyBasePoweredDown"</span>);
<a name="l00425"></a>00425                 }
<a name="l00426"></a>00426                 effectApplied = <span class="keyword">true</span>;
<a name="l00427"></a>00427         }
<a name="l00428"></a>00428 
<a name="l00429"></a>00429 
<a name="l00430"></a>00430         <span class="keywordflow">if</span>(pTypeExt-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#81cfd3d9fac97a6d3abc0aca99314a0f">StolenTechIndex</a> &gt; -1) {
<a name="l00431"></a>00431                 pEntererExt-&gt;<a class="code" href="class_house_ext_1_1_ext_data.html#ce1912ce3550a6fc71ac04f280251412">StolenTech</a>.set(pTypeExt-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#81cfd3d9fac97a6d3abc0aca99314a0f">StolenTechIndex</a>);
<a name="l00432"></a>00432 
<a name="l00433"></a>00433                 Enterer-&gt;ShouldRecheckTechTree = <span class="keyword">true</span>;
<a name="l00434"></a>00434                 <span class="keywordflow">if</span>(evaForOwner) {
<a name="l00435"></a>00435                         VoxClass::Play(<span class="stringliteral">"EVA_TechnologyStolen"</span>);
<a name="l00436"></a>00436                 }
<a name="l00437"></a>00437                 <span class="keywordflow">if</span>(evaForEnterer) {
<a name="l00438"></a>00438                         VoxClass::Play(<span class="stringliteral">"EVA_BuildingInfiltrated"</span>);
<a name="l00439"></a>00439                         VoxClass::Play(<span class="stringliteral">"EVA_NewTechnologyAcquired"</span>);
<a name="l00440"></a>00440                 }
<a name="l00441"></a>00441                 effectApplied = <span class="keyword">true</span>;
<a name="l00442"></a>00442         }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 
<a name="l00445"></a>00445         <span class="keywordflow">if</span>(pTypeExt-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#0d2399db8a5c5b75ce092fa1b036c9ad">ResetSW</a>) {
<a name="l00446"></a>00446                 <span class="keywordtype">bool</span> somethingReset = <span class="keyword">false</span>;
<a name="l00447"></a>00447                 <span class="keywordtype">int</span> swIdx = EnteredType-&gt;SuperWeapon;
<a name="l00448"></a>00448                 <span class="keywordflow">if</span>(swIdx != -1) {
<a name="l00449"></a>00449                         Owner-&gt;Supers.Items[swIdx]-&gt;Reset();
<a name="l00450"></a>00450                         somethingReset = <span class="keyword">true</span>;
<a name="l00451"></a>00451                 }
<a name="l00452"></a>00452                 swIdx = EnteredType-&gt;SuperWeapon2;
<a name="l00453"></a>00453                 <span class="keywordflow">if</span>(swIdx != -1) {
<a name="l00454"></a>00454                         Owner-&gt;Supers.Items[swIdx]-&gt;Reset();
<a name="l00455"></a>00455                         somethingReset = <span class="keyword">true</span>;
<a name="l00456"></a>00456                 }
<a name="l00457"></a>00457                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; EnteredType-&gt;Upgrades; ++i) {
<a name="l00458"></a>00458                         <span class="keywordflow">if</span>(BuildingTypeClass *Upgrade = EnteredBuilding-&gt;Upgrades[i]) {
<a name="l00459"></a>00459                                 swIdx = Upgrade-&gt;SuperWeapon;
<a name="l00460"></a>00460                                 <span class="keywordflow">if</span>(swIdx != -1) {
<a name="l00461"></a>00461                                         Owner-&gt;Supers.Items[swIdx]-&gt;Reset();
<a name="l00462"></a>00462                                         somethingReset = <span class="keyword">true</span>;
<a name="l00463"></a>00463                                 }
<a name="l00464"></a>00464                                 swIdx = Upgrade-&gt;SuperWeapon2;
<a name="l00465"></a>00465                                 <span class="keywordflow">if</span>(swIdx != -1) {
<a name="l00466"></a>00466                                         Owner-&gt;Supers.Items[swIdx]-&gt;Reset();
<a name="l00467"></a>00467                                         somethingReset = <span class="keyword">true</span>;
<a name="l00468"></a>00468                                 }
<a name="l00469"></a>00469                         }
<a name="l00470"></a>00470                 }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472                 <span class="keywordflow">if</span>(somethingReset) {
<a name="l00473"></a>00473                         <span class="keywordflow">if</span>(evaForOwner || evaForEnterer) {
<a name="l00474"></a>00474                                 VoxClass::Play(<span class="stringliteral">"EVA_BuildingInfiltrated"</span>);
<a name="l00475"></a>00475                         }
<a name="l00476"></a>00476                         effectApplied = <span class="keyword">true</span>;
<a name="l00477"></a>00477                 }
<a name="l00478"></a>00478         }
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 
<a name="l00481"></a>00481         <span class="keywordtype">int</span> bounty = 0;
<a name="l00482"></a>00482         <span class="keywordtype">int</span> available = Owner-&gt;Available_Money();
<a name="l00483"></a>00483         <span class="keywordflow">if</span>(pTypeExt-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#44649082621edbe59f4872e764c941f8">StolenMoneyAmount</a> &gt; 0) {
<a name="l00484"></a>00484                 bounty = pTypeExt-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#44649082621edbe59f4872e764c941f8">StolenMoneyAmount</a>;
<a name="l00485"></a>00485         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pTypeExt-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#42adb55bc3f116a50c362d85f1487915">StolenMoneyPercentage</a> &gt; 0) {
<a name="l00486"></a>00486                 bounty = int(available * pTypeExt-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#42adb55bc3f116a50c362d85f1487915">StolenMoneyPercentage</a>);
<a name="l00487"></a>00487         }
<a name="l00488"></a>00488         <span class="keywordflow">if</span>(bounty &gt; 0) {
<a name="l00489"></a>00489                 bounty = min(bounty, available);
<a name="l00490"></a>00490                 Owner-&gt;TakeMoney(bounty);
<a name="l00491"></a>00491                 Enterer-&gt;GiveMoney(bounty);
<a name="l00492"></a>00492                 <span class="keywordflow">if</span>(evaForOwner) {
<a name="l00493"></a>00493                         VoxClass::Play(<span class="stringliteral">"EVA_CashStolen"</span>);
<a name="l00494"></a>00494                 }
<a name="l00495"></a>00495                 <span class="keywordflow">if</span>(evaForEnterer) {
<a name="l00496"></a>00496                         VoxClass::Play(<span class="stringliteral">"EVA_BuildingInfCashStolen"</span>);
<a name="l00497"></a>00497                 }
<a name="l00498"></a>00498                 effectApplied = <span class="keyword">true</span>;
<a name="l00499"></a>00499         }
<a name="l00500"></a>00500 
<a name="l00501"></a>00501 
<a name="l00502"></a>00502         <span class="keywordflow">if</span>(pTypeExt-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#ee2513b07f6b439bc64f40f733546133">GainVeterancy</a>) {
<a name="l00503"></a>00503                 <span class="keywordtype">bool</span> promotionStolen = <span class="keyword">true</span>;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505                 <span class="keywordflow">switch</span>(EnteredType-&gt;Factory) {
<a name="l00506"></a>00506                         <span class="keywordflow">case</span> UnitTypeClass::AbsID:
<a name="l00507"></a>00507                                 Enterer-&gt;WarFactoryInfiltrated = <span class="keyword">true</span>;
<a name="l00508"></a>00508                                 <span class="keywordflow">break</span>;
<a name="l00509"></a>00509                         <span class="keywordflow">case</span> InfantryTypeClass::AbsID:
<a name="l00510"></a>00510                                 Enterer-&gt;BarracksInfiltrated = <span class="keyword">true</span>;
<a name="l00511"></a>00511                                 <span class="keywordflow">break</span>;
<a name="l00512"></a>00512                                 <span class="comment">// TODO: aircraft/building</span>
<a name="l00513"></a>00513                         <span class="keywordflow">default</span>:
<a name="l00514"></a>00514                                 promotionStolen = <span class="keyword">false</span>;
<a name="l00515"></a>00515                 }
<a name="l00516"></a>00516 
<a name="l00517"></a>00517                 <span class="keywordflow">if</span>(promotionStolen) {
<a name="l00518"></a>00518                         Enterer-&gt;ShouldRecheckTechTree = <span class="keyword">true</span>;
<a name="l00519"></a>00519                         <span class="keywordflow">if</span>(Enterer-&gt;ControlledByPlayer()) {
<a name="l00520"></a>00520                                 MouseClass::Instance-&gt;SidebarNeedsRepaint();
<a name="l00521"></a>00521                         }
<a name="l00522"></a>00522                         <span class="keywordflow">if</span>(evaForOwner) {
<a name="l00523"></a>00523                                 VoxClass::Play(<span class="stringliteral">"EVA_TechnologyStolen"</span>);
<a name="l00524"></a>00524                         }
<a name="l00525"></a>00525                         <span class="keywordflow">if</span>(evaForEnterer) {
<a name="l00526"></a>00526                                 VoxClass::Play(<span class="stringliteral">"EVA_BuildingInfiltrated"</span>);
<a name="l00527"></a>00527                                 VoxClass::Play(<span class="stringliteral">"EVA_NewTechnologyAcquired"</span>);
<a name="l00528"></a>00528                         }
<a name="l00529"></a>00529                         effectApplied = <span class="keyword">true</span>;
<a name="l00530"></a>00530                 }
<a name="l00531"></a>00531         }
<a name="l00532"></a>00532 
<a name="l00533"></a>00533 
<a name="l00534"></a>00534         <span class="comment">/*      RA1-Style Spying, as requested in issue #633</span>
<a name="l00535"></a>00535 <span class="comment">                This sets the respective bit to inform the game that a particular house has spied this building.</span>
<a name="l00536"></a>00536 <span class="comment">                Knowing that, the game will reveal the current production in this building to the players who have spied it.</span>
<a name="l00537"></a>00537 <span class="comment">                In practice, this means: If a player who has spied a factory clicks on that factory,</span>
<a name="l00538"></a>00538 <span class="comment">                he will see the cameo of whatever is being built in the factory.</span>
<a name="l00539"></a>00539 <span class="comment"></span>
<a name="l00540"></a>00540 <span class="comment">                Addition 04.03.10: People complained about it not being optional. Now it is.</span>
<a name="l00541"></a>00541 <span class="comment">        */</span>
<a name="l00542"></a>00542         <span class="keywordflow">if</span>(pTypeExt-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#d54b9d19d3b6a738f7102ba38ad1d42c">RevealProduction</a>) {
<a name="l00543"></a>00543                 EnteredBuilding-&gt;DisplayProductionTo.Add(Enterer);
<a name="l00544"></a>00544                 <span class="keywordflow">if</span>(evaForOwner || evaForEnterer) {
<a name="l00545"></a>00545                         VoxClass::Play(<span class="stringliteral">"EVA_BuildingInfiltrated"</span>);
<a name="l00546"></a>00546                 }
<a name="l00547"></a>00547                 effectApplied = <span class="keyword">true</span>;
<a name="l00548"></a>00548         }
<a name="l00549"></a>00549 
<a name="l00550"></a>00550         <span class="keywordflow">if</span>(pTypeExt-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#8572ca3cc41b1edac1c3f3ce1addc921">RevealRadar</a>) {
<a name="l00551"></a>00551                 EnteredBuilding-&gt;DisplayProductionTo.Add(Enterer);
<a name="l00552"></a>00552                 <a class="code" href="class_building_ext.html#7cc1e762dfcded375fd8d8f53f23e700">BuildingExt::UpdateDisplayTo</a>(EnteredBuilding);
<a name="l00553"></a>00553                 <span class="keywordflow">if</span>(evaForOwner || evaForEnterer) {
<a name="l00554"></a>00554                         VoxClass::Play(<span class="stringliteral">"EVA_BuildingInfiltrated"</span>);
<a name="l00555"></a>00555                 }
<a name="l00556"></a>00556                 MapClass::Instance-&gt;sub_657CE0();
<a name="l00557"></a>00557                 MapClass::Instance-&gt;sub_4F42F0(2);
<a name="l00558"></a>00558                 effectApplied = <span class="keyword">true</span>;
<a name="l00559"></a>00559         }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561         <span class="keywordflow">if</span>(effectApplied) {
<a name="l00562"></a>00562                 EnteredBuilding-&gt;SetLayer(lyr_Ground);
<a name="l00563"></a>00563         }
<a name="l00564"></a>00564         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00565"></a>00565 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="4918704e582482416d8a6a0232bd3e93"></a><!-- doxytag: member="BuildingExt::ExtData::InvalidatePointer" ref="4918704e582482416d8a6a0232bd3e93" args="(void *ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void BuildingExt::BuildingExt::ExtData::InvalidatePointer           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ptr</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Implements <a class="el" href="class_extension.html#9e6b2ac570eddadb2ca3c01668da88b8">Extension&lt; TT &gt;</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00054"></a>00054                                                           {
<a name="l00055"></a>00055                         AnnounceInvalidPointer(<a class="code" href="class_building_ext_1_1_ext_data.html#7270bd5eb03823bf3ed264a38e645455" title="Contains the house which owned this building prior to it being raided and turned...">OwnerBeforeRaid</a>, ptr);
<a name="l00056"></a>00056                 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="7523847404477cd1be29ab2f403d4fb3"></a><!-- doxytag: member="BuildingExt::ExtData::isLinkable" ref="7523847404477cd1be29ab2f403d4fb3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool BuildingExt::BuildingExt::ExtData::isLinkable           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns true if this is a structure that can be linked to other structures, like a wall, fence, or trench. This is used to quick-check if the game has to look for linkable buildings in the first place. 
<p>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="class_building_ext_1_1_ext_data.html#63d2873ee89296616c24bc3a440819d1" title="Checks if the current building can link to the given target building.">canLinkTo()</a> </dd></dl>
<div class="fragment"><pre class="fragment"><a name="l00226"></a>00226                                     {
<a name="l00227"></a>00227         <a class="code" href="class_building_type_ext_1_1_ext_data.html">BuildingTypeExt::ExtData</a>* typeExtData = <a class="code" href="class_building_type_ext.html#9643fa629dd6d2a20eeefa4942d8612a">BuildingTypeExt::ExtMap</a>.<a class="code" href="class_container.html#90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(this-&gt;<a class="code" href="class_extension.html#72742b36a0db81d6697da473dfe8281d">AttachedToObject</a>-&gt;Type);
<a name="l00228"></a>00228         <span class="keywordflow">return</span> typeExtData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#f612e50430ba9dc534661fe0c1594b74">IsLinkable</a>();
<a name="l00229"></a>00229 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="21d04400f5987ecf67d56b132700b063"></a><!-- doxytag: member="BuildingExt::ExtData::RubbleYell" ref="21d04400f5987ecf67d56b132700b063" args="(bool beingRepaired=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BuildingExt::BuildingExt::ExtData::RubbleYell           </td>
          <td>(</td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>beingRepaired</em> = <code>false</code>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function switches the building into its Advanced Rubble state or back to normal. 
<p>
If no respective target-state object exists in the <a class="el" href="class_building_ext_1_1_ext_data.html">ExtData</a> so far, the function will create it. It'll check beforehand whether the necessary Rubble.Intact or Rubble.Destroyed are actually set on the type. If the necessary one is not set, it'll log a debug message and abort.<p>
Rubble is set to full health on placing, since, no matter what we do in the backend, to the player, each pile of rubble is a new one. The reconstructed building, on the other hand, is set to 1% of it's health, since it was just no reconstructed, and not freshly built or repaired yet. UPDATE: Due to practical concerns, rubble health will be set to 99% of its health and be prevented from being click-repairable, in order to ensure Engineers always get a repair cursor and can enter to repair.<p>
Lastly, the function will set the current building as the alternate state on the other state, to ensure that, if the other state gets triggered back, it is connected to this state. (e.g. when a building is turned into rubble, the normal state will set itself as the normal state of the rubble, so when the rubble is reconstructed, it switches back to the correct normal state.)<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>beingRepaired</em>&nbsp;</td><td>if set to true, the function will turn the building back into its normal state. If false or unset, the building will be turned into rubble.</td></tr>
  </table>
</dl>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Renegade </dd></dl>
<dl class="date" compact><dt><b>Date:</b></dt><dd>16.12.09+ </dd></dl>
<div class="fragment"><pre class="fragment"><a name="l00076"></a>00076                                                       {
<a name="l00077"></a>00077         BuildingClass* currentBuilding = this-&gt;<a class="code" href="class_extension.html#72742b36a0db81d6697da473dfe8281d">AttachedToObject</a>;
<a name="l00078"></a>00078         <a class="code" href="class_building_type_ext_1_1_ext_data.html">BuildingTypeExt::ExtData</a>* pTypeData = <a class="code" href="class_building_type_ext.html#9643fa629dd6d2a20eeefa4942d8612a">BuildingTypeExt::ExtMap</a>.<a class="code" href="class_container.html#90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(currentBuilding-&gt;Type);
<a name="l00079"></a>00079         BuildingClass* newState = NULL;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081         currentBuilding-&gt;Remove(); <span class="comment">// only takes it off the map</span>
<a name="l00082"></a>00082         currentBuilding-&gt;DestroyNthAnim(BuildingAnimSlot::All);
<a name="l00083"></a>00083 
<a name="l00084"></a>00084         <span class="keywordflow">if</span>(beingRepaired) {
<a name="l00085"></a>00085                 <span class="keywordflow">if</span>(!pTypeData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#540c722c0770aa5a4db400f331bfd098" title="What BuildingType to turn into when reconstructed. (This is the normal building,...">RubbleIntact</a>) {
<a name="l00086"></a>00086                         Debug::Log(<span class="stringliteral">"Warning! Advanced Rubble was supposed to be reconstructed but Ares could not obtain its normal state. \</span>
<a name="l00087"></a>00087 <span class="stringliteral">                        Check if [%s]Rubble.Intact is set (correctly).\n"</span>, currentBuilding-&gt;Type-&gt;ID);
<a name="l00088"></a>00088                         <span class="keywordflow">return</span>;
<a name="l00089"></a>00089                 }
<a name="l00090"></a>00090 
<a name="l00091"></a>00091                 newState = specific_cast&lt;BuildingClass *&gt;(pTypeData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#540c722c0770aa5a4db400f331bfd098" title="What BuildingType to turn into when reconstructed. (This is the normal building,...">RubbleIntact</a>-&gt;CreateObject(currentBuilding-&gt;Owner));
<a name="l00092"></a>00092                 newState-&gt;Health = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(newState-&gt;Type-&gt;Strength / 100); <span class="comment">// see description above</span>
<a name="l00093"></a>00093                 newState-&gt;IsAlive = <span class="keyword">true</span>; <span class="comment">// assuming this is in the sense of "is not destroyed"</span>
<a name="l00094"></a>00094                 <span class="comment">// Location should not be changed by removal</span>
<a name="l00095"></a>00095                 <span class="keywordflow">if</span>(!newState-&gt;Put(&amp;currentBuilding-&gt;Location, currentBuilding-&gt;Facing)) {
<a name="l00096"></a>00096                         Debug::Log(<span class="stringliteral">"Advanced Rubble: Failed to place normal state on map!\n"</span>);
<a name="l00097"></a>00097                         GAME_DEALLOC(newState);
<a name="l00098"></a>00098                 }
<a name="l00099"></a>00099                 currentBuilding-&gt;UnInit();
<a name="l00100"></a>00100 
<a name="l00101"></a>00101         } <span class="keywordflow">else</span> { <span class="comment">// if we're not here to repair that thing, obviously, we're gonna crush it</span>
<a name="l00102"></a>00102                 <span class="keywordflow">if</span>(!pTypeData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#651a8bd6ba32545c28b1839a1a927f4f" title="What BuildingType to turn into when destroyed. (This is the rubble, set on normal...">RubbleDestroyed</a>) {
<a name="l00103"></a>00103                         Debug::Log(<span class="stringliteral">"Warning! Building was supposed to be turned into Advanced Rubble but Ares could not obtain its rubble state. \</span>
<a name="l00104"></a>00104 <span class="stringliteral">                        Check if [%s]Rubble.Destroyed is set (correctly).\n"</span>, currentBuilding-&gt;Type-&gt;ID);
<a name="l00105"></a>00105                         <span class="keywordflow">return</span>;
<a name="l00106"></a>00106                 }
<a name="l00107"></a>00107 
<a name="l00108"></a>00108                 newState = specific_cast&lt;BuildingClass *&gt;(pTypeData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#651a8bd6ba32545c28b1839a1a927f4f" title="What BuildingType to turn into when destroyed. (This is the rubble, set on normal...">RubbleDestroyed</a>-&gt;CreateObject(currentBuilding-&gt;Owner));
<a name="l00109"></a>00109                 newState-&gt;Health = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(newState-&gt;Type-&gt;Strength * 0.99); <span class="comment">// see description above</span>
<a name="l00110"></a>00110                 <span class="comment">// Location should not be changed by removal</span>
<a name="l00111"></a>00111                 <span class="keywordflow">if</span>(!newState-&gt;Put(&amp;currentBuilding-&gt;Location, currentBuilding-&gt;Facing)) {
<a name="l00112"></a>00112                         Debug::Log(<span class="stringliteral">"Advanced Rubble: Failed to place rubble state on map!\n"</span>);
<a name="l00113"></a>00113                         GAME_DEALLOC(newState);
<a name="l00114"></a>00114                 }
<a name="l00115"></a>00115         }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117         <span class="keywordflow">return</span>;
<a name="l00118"></a>00118 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e4a73a7dee4d4ffb1e68a2aa3355ef6f"></a><!-- doxytag: member="BuildingExt::ExtData::sameTrench" ref="e4a73a7dee4d4ffb1e68a2aa3355ef6f" args="(BuildingClass *targetBuilding)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool BuildingExt::BuildingExt::ExtData::sameTrench           </td>
          <td>(</td>
          <td class="paramtype">BuildingClass *&nbsp;</td>
          <td class="paramname"> <em>targetBuilding</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if the current and the target building are both of the same trench kind. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>targetBuilding</em>&nbsp;</td><td>a pointer to the target building. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>true if both buildings are trenches and are of the same trench kind, otherwise false.</dd></dl>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Renegade </dd></dl>
<dl class="date" compact><dt><b>Date:</b></dt><dd>25.12.09+ </dd></dl>
<div class="fragment"><pre class="fragment"><a name="l00129"></a>00129                                                                  {
<a name="l00130"></a>00130         <a class="code" href="class_building_type_ext_1_1_ext_data.html">BuildingTypeExt::ExtData</a>* currentTypeExtData = <a class="code" href="class_building_type_ext.html#9643fa629dd6d2a20eeefa4942d8612a">BuildingTypeExt::ExtMap</a>.<a class="code" href="class_container.html#90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(this-&gt;<a class="code" href="class_extension.html#72742b36a0db81d6697da473dfe8281d">AttachedToObject</a>-&gt;Type);
<a name="l00131"></a>00131         <a class="code" href="class_building_type_ext_1_1_ext_data.html">BuildingTypeExt::ExtData</a>* targetTypeExtData = <a class="code" href="class_building_type_ext.html#9643fa629dd6d2a20eeefa4942d8612a">BuildingTypeExt::ExtMap</a>.<a class="code" href="class_container.html#90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(targetBuilding-&gt;Type);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133         <span class="keywordflow">return</span> ((currentTypeExtData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#3af26b553e32907458b023e766272dd7" title="Enables moving between segments - saves ID of a kind of trench.">IsTrench</a> &gt; -1) &amp;&amp; (currentTypeExtData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#3af26b553e32907458b023e766272dd7" title="Enables moving between segments - saves ID of a kind of trench.">IsTrench</a> == targetTypeExtData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#3af26b553e32907458b023e766272dd7" title="Enables moving between segments - saves ID of a kind of trench.">IsTrench</a>));
<a name="l00134"></a>00134 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="d63c5123584319b1984524dc5b758c04"></a><!-- doxytag: member="BuildingExt::ExtData::Size" ref="d63c5123584319b1984524dc5b758c04" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual size_t BuildingExt::BuildingExt::ExtData::Size           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td> const<code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Implements <a class="el" href="class_extension.html#44ddedd12613b24b7b03d21982782047">Extension&lt; TT &gt;</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00052"></a>00052 { <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(*this); };
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="93ddc852a6c29c34bc69d746797ecae5"></a><!-- doxytag: member="BuildingExt::ExtData::UpdateFirewall" ref="93ddc852a6c29c34bc69d746797ecae5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BuildingExt::BuildingExt::ExtData::UpdateFirewall           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment"><a name="l00567"></a>00567                                         {
<a name="l00568"></a>00568         BuildingClass *B = this-&gt;<a class="code" href="class_extension.html#72742b36a0db81d6697da473dfe8281d">AttachedToObject</a>;
<a name="l00569"></a>00569         BuildingTypeClass *BT = B-&gt;Type;
<a name="l00570"></a>00570         HouseClass *H = B-&gt;Owner;
<a name="l00571"></a>00571         <a class="code" href="class_building_type_ext_1_1_ext_data.html">BuildingTypeExt::ExtData</a>* pTypeData = <a class="code" href="class_building_type_ext.html#9643fa629dd6d2a20eeefa4942d8612a">BuildingTypeExt::ExtMap</a>.<a class="code" href="class_container.html#90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(BT);
<a name="l00572"></a>00572 
<a name="l00573"></a>00573         <span class="keywordflow">if</span>(!pTypeData-&gt;<a class="code" href="class_building_type_ext_1_1_ext_data.html#51503707d3c7be1bcd829f893acdd21e">Firewall_Is</a>) {
<a name="l00574"></a>00574                 <span class="keywordflow">return</span>;
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577         <a class="code" href="class_house_ext_1_1_ext_data.html">HouseExt::ExtData</a> *pHouseData = <a class="code" href="class_house_ext.html#4a73e500fabd21a7359c5247c31d4c03">HouseExt::ExtMap</a>.<a class="code" href="class_container.html#90ddec0f8fb14f5a9894e128c2f938fc">Find</a>(H);
<a name="l00578"></a>00578         <span class="keywordtype">bool</span> FS = pHouseData-&gt;<a class="code" href="class_house_ext_1_1_ext_data.html#f2e91b1fc2de13ab1e96ff1242cab060">FirewallActive</a>;
<a name="l00579"></a>00579 
<a name="l00580"></a>00580         DWORD FWFrame = <a class="code" href="class_building_ext.html#223949406041a5bcab3aeca6730375b2">BuildingExt::GetFirewallFlags</a>(B);
<a name="l00581"></a>00581         <span class="keywordflow">if</span>(FS) {
<a name="l00582"></a>00582                 FWFrame += 32;
<a name="l00583"></a>00583         }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585         <span class="keywordflow">if</span>(B-&gt;FirestormWallFrame != FWFrame) {
<a name="l00586"></a>00586                 <span class="keywordflow">if</span>(!pHouseData-&gt;<a class="code" href="class_house_ext_1_1_ext_data.html#6bf7b3d85fec9886bfb7c2ea6abf9db9">FirewallRecalc</a>) {
<a name="l00587"></a>00587                         pHouseData-&gt;<a class="code" href="class_house_ext_1_1_ext_data.html#6bf7b3d85fec9886bfb7c2ea6abf9db9">FirewallRecalc</a> = 1;
<a name="l00588"></a>00588                 }
<a name="l00589"></a>00589                 B-&gt;FirestormWallFrame = FWFrame;
<a name="l00590"></a>00590                 B-&gt;GetCell()-&gt;Setup(0xFFFFFFFF);
<a name="l00591"></a>00591                 B-&gt;SetLayer(lyr_Ground); <span class="comment">// HACK - repaints properly</span>
<a name="l00592"></a>00592         }
<a name="l00593"></a>00593 
<a name="l00594"></a>00594         <span class="keywordflow">if</span>(!FS) {
<a name="l00595"></a>00595                 <span class="keywordflow">return</span>;
<a name="l00596"></a>00596         }
<a name="l00597"></a>00597 
<a name="l00598"></a>00598         <span class="keywordflow">if</span>(!(Unsorted::CurrentFrame % 7) &amp;&amp; ScenarioClass::Instance-&gt;Random.RandomRanged(0, 15) == 1) {
<a name="l00599"></a>00599                 <span class="keywordtype">int</span> corners = (FWFrame &amp; 0xF); <span class="comment">// 1111b</span>
<a name="l00600"></a>00600                 <span class="keywordflow">if</span>(AnimClass *IdleAnim = B-&gt;FirestormAnim) {
<a name="l00601"></a>00601                         GAME_DEALLOC(IdleAnim);
<a name="l00602"></a>00602                         B-&gt;FirestormAnim = 0;
<a name="l00603"></a>00603                 }
<a name="l00604"></a>00604                 <span class="keywordflow">if</span>(corners != 5 &amp;&amp; corners != 10) {  <span class="comment">// (0101b || 1010b) == part of a straight line</span>
<a name="l00605"></a>00605                         CoordStruct XYZ;
<a name="l00606"></a>00606                         B-&gt;GetCoords(&amp;XYZ);
<a name="l00607"></a>00607                         XYZ.X -= 768;
<a name="l00608"></a>00608                         XYZ.Y -= 768;
<a name="l00609"></a>00609                         <span class="keywordflow">if</span>(AnimTypeClass *FSA = AnimTypeClass::Find(<span class="stringliteral">"FSIDLE"</span>)) {
<a name="l00610"></a>00610                                 GAME_ALLOC(AnimClass, B-&gt;FirestormAnim, FSA, &amp;XYZ);
<a name="l00611"></a>00611                         }
<a name="l00612"></a>00612                 }
<a name="l00613"></a>00613         }
<a name="l00614"></a>00614 
<a name="l00615"></a>00615         this-&gt;<a class="code" href="class_building_ext_1_1_ext_data.html#38ded93820573fc9f724e4aadbc49bcb">ImmolateVictims</a>();
<a name="l00616"></a>00616 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="7979cb23cb460430680ac03b35ca23f1"></a><!-- doxytag: member="BuildingExt::ExtData::ignoreNextEVA" ref="7979cb23cb460430680ac03b35ca23f1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool BuildingExt::BuildingExt::ExtData::ignoreNextEVA          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This is used when returning raided buildings, to decide whether to play EVA announcements about building capture. 
<p>

</div>
</div><p>
<a class="anchor" name="f8a542bf713fcbfc1bf81a7cfa5ed2c1"></a><!-- doxytag: member="BuildingExt::ExtData::isCurrentlyRaided" ref="f8a542bf713fcbfc1bf81a7cfa5ed2c1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool BuildingExt::BuildingExt::ExtData::isCurrentlyRaided          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Whether this building is currently occupied by someone not the actual owner of the structure. 
<p>

</div>
</div><p>
<a class="anchor" name="7270bd5eb03823bf3ed264a38e645455"></a><!-- doxytag: member="BuildingExt::ExtData::OwnerBeforeRaid" ref="7270bd5eb03823bf3ed264a38e645455" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HouseClass* BuildingExt::BuildingExt::ExtData::OwnerBeforeRaid          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Contains the house which owned this building prior to it being raided and turned over to the raiding party. 
<p>

</div>
</div><p>
<a class="anchor" name="17fa3d91f003a8ec0e48bed89bfb1ca2"></a><!-- doxytag: member="BuildingExt::ExtData::PrismForwarding" ref="17fa3d91f003a8ec0e48bed89bfb1ca2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_building_ext_1_1c_prism_forwarding.html">cPrismForwarding</a> BuildingExt::BuildingExt::ExtData::PrismForwarding          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr>The documentation for this class was generated from the following files:<ul>
<li>Ext/Building/<a class="el" href="_building_2_body_8h.html">Body.h</a><li>Ext/Building/<a class="el" href="_building_2_body_8cpp.html">Body.cpp</a></ul>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat May 29 11:15:57 2010 for Ares by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
